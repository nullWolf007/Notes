[TOC]

# JVM和DVM和ART的比较

### 参考

* [**JVM、DVM、ANDROID RUN TIME(art)的区别（简易篇）**](https://www.jianshu.com/p/2bdc60e118f5)

## 一、JVM和DVM的区别

### 1.1 前言

```text
JVM即Java Virtual Machine，而DVM就是Dalvik Virtual Machine。
```

### 1.2 DVM

```text
Android系统使用DVM作为虚拟机，所有的安卓程序都运行在安卓系统进程里，每个进程都对应一个Dalvik虚拟机实例。
他们都提供了对象生命周期管理、堆栈管理、线程管理、安全和异常管理以及垃圾回收等重要功能，各自拥有一套完整的指令系统。
```

### 1.3 区别

* JVM运行的是java字节码，即.class文件；DVM运行的dalvik字节码，即.dex(dalvik executable)文件

* .dex可执行文件体积更小

  ```text
  .class文件包含多个不同的方法签名，
  如果A类文件引用B类文件中的方法，方法签名也会被复制到A类文件中，也就是说，多个不同的类会同时包含相同的方法签名，
  同样地，大量的字符串常量在多个类文件中也被重复使用，这些冗余信息会增加文件的体积，
  而JVM在把描述类的数据从class文件加载到内存时，需要对数据进行校验、转换解析和初始化。
  由于大量的冗余信息，会严重影响虚拟机解析文件的效率
  
  为了减少执行文件的体积，安卓使用DVM，
  SDK中有个dx工具负责将java字节码转换成dalvik字节码，
  dx工具对.class文件重新排列，将所有.class文件中的常量池分解，消除其中的冗余信息，重新组合形成一个常量池，
  所有的类文件共享同一个常量池，使得相同的字符串、常量在dex文件中只出现一次，从而减少了文件的体积。
  ```

* JVM基于栈，DVM基于寄存器

  ```text
  JVM基于栈结构，程序在运行时虚拟机需要频繁的从栈上读取写入数据，这个过程需要更多的指令分派与内存访问次数，会耗费很多CPU时间
  
  DVM基于寄存器架构，数据的访问通过寄存器间直接传递，这样的访问方式比基于栈方式快很多
  ```

### 1.4 知识补充

* 寄存器架构和栈架构的区别

  [**于堆栈的(Stack-based ) 和基于寄存器(Register-based) 的虚拟机区别**](https://blog.csdn.net/u010385624/article/details/78883024)

## 二、DVM和ART的区别

### 2..1 ART

```text
ART即Android runtime（android 4.4发布引入的）
优点：
1.系统性能显著提神
2.应用启动更快，运行更快，体现更流畅，触感反馈更及时
3.续航能力提升
4.支持更低的硬件
缺点：
1.更大的存储控件占用，可能增加10%-20%
2.更长的应用安装时间
```

### 2.2 DVM执行的是dex字节码，ART执行的是本地机器码

```text
DVM执行的是dex字节码，依靠JIT编译器去解释执行，运行时动态地将执行频率很高地dex字节码翻译成本地机器码，然后再执行。
但是将dex字节码翻译成本地机器码是发生在应用程序的运行过程中，并且应用程序每一次重新运行的时候，都要重新进行翻译。
因此，即使采用了JIT，DVM的总体性能还是不能与直接执行本地机器码的ART相比

安卓运行时从DVM替换成ART。
并不要求开发者重新将自己的应用直接编译成目标机器码，也就是说，应用程序仍然是一个包含dex字节码的apk文件。
所以在安装应用的时候，dex中的字节码将被编译成本地机器码，之后每次打开应用，执行的都是本地机器码。
因为移除了运行时的解释执行，所以效率更高，启动更快。
```



